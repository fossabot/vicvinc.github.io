---
title: hexo-theme-development-tips
date: 2017-07-12 00:57:34
tags: [hexo-blog-dev]
cover: cover.png
myexcerpt: 自制Hexo主题遇到的一些问题
---

之前零零散散的弄过一些博客，其实感觉现在已经没有必要自己折腾这些了，现在的博客系统比之前的好太多，像[Mediun](https://medium.com)这样的书写平台，写起东西来不必要太舒服。

但是还是想自己改造一个主题，说是改造其实是受Medium和Airbnb的影响，感觉需要一个有一点设计感的博客，所以花了三天时间大概改造完成了。

《黑客与画家》里面说过，写软件和画画其实是非常相似的过程，对于画画来说，可能没有画好的那一天，只是你停止画它了。对于软件来说，也许没有写好的那一天，只是停止继续开发了，设计应该也是相同的过程吧，一直修修改改，对于主题类的UI来说，也是同样的道理。功能完成之后，又想去优化，优化完成之后，又想把功能聚类，无限的循环下去。好了现在来谈谈这次自制的主题V1.0.1版本的开发历程😊

首先，对于博客系统来说，是以文本为主要信息载体的发布系统，这里扯一点文件存储和数据库存储，之前浏览器端渲染没有这么流行的时候，大家都是自建server，然后做server渲染的blog。这样其实很好其实成本也比较高。如果是一个团队的话，多个人共用一套博客系统，那么这样做就很好了，在博客系统上还可以集成很多其他的其他的功能给大家使用，比如Wiki，IRC，反正租一台主机不充分利用的话会觉得很浪费的😄。后来出现了Jekyll，ruby的文件存储博客系统，Jekyll和Hexo的思路一样，都是事先定义好渲染的款式，将博客内容渲染成一个一个的文件，然后通过Http访问来查看不同的博客。这样做的好处就是不需要server端做渲染了，只需要一台能够被公网访问到的文件服务器即可，但是问题就是如果我的文章写了很多很多的话，每次渲染就会花比较长的时间了。但是对于个人博客来说，一般能有几千的文章数已经是成年累月积攒下来的了，所以还是能在接受的范围内。对于文件储存和数据库存储，少量数据的话感觉文件存储效率高一些，大量数据肯定是数据库效率高，因为数据库有存储引擎，对文件的存储组织方式要比原声的文件少很多碎片，在查询的时候，数据库的索引表又能够快速的进行查找，同时数据库是对元数据进行储存的，可以根据不同的需要将元数据进行组合满足不同的业务，文件存储虽然可以做到元数据的存储，但是检索过程差不多也可以写一个存储引擎了。数据库存储可以做到时时读写，文件存储虽然也可以做到，但是安全性就不是那么乐观了。总之，对于个人博客来说，文件存储是完全够用啦🤷‍。


我的选择是从Next theme下手，先粗略的看了一下theme的文件结构，对于swig的语法不是很了解，但是也不需要学习。以下就开始了第一次的尝试工作：

1. 从theme的__layout.swig开始，挨个删除不需要的模块，比如百度统计啦，百度Push啦等等
2. 从themem的__config.yml的配置开始，挨个删除不需要的配置，比如facebook的sdk啦之类
3. 得到一个精简版的主题
4. 在3的基础上进行尊享的私人化定制
5. 成功

流程是没有问题的，如果Hexo的报错信息能够让我定位到每个模板文件的具体行数的话…如果Hexo的报错信息能够让我定位到哪个配置的参数缺失的话… 😢
总之尝试失败了🤦‍

总结了一下第一次尝试失败的几个原因：

1. 对于Hexo的调试信息不够了解，原来渲染出错可以直接白屏的！居然不告诉我哪个模板的多少行渲染有问题
2. 对于Hexo的报错信息完全无法追踪，比如捕获到一只异常，却发现我根本不知道这个异常是什么文件引起的 🤦‍
3. 删除了模板模块和配置文件之后Hexo的渲染滞后导致我一路狂删最后出错不知道该回退到什么地步的 ‍🤦‍

总结一下，对文本进行渲染的博客系统，通常渲染的时候是通过文件流来渲染的，即如果渲染的结果出现了错误的话，是追踪不到渲染模板那一行的数据内容出错了的，只能追踪到模板的语法层错误。所以开始想从一个精简的版本开始开发定制，还不如直接从空白的版本开始，那样会更快一些，但是空白的版本需要看很多的开发文档，如果是精简版的主题，模板内部本身就有很多可以参考的钩子接口，这样会更快一些。

真的男默女泪，中间有一段时间想切换到react的渲染引擎博客系统下，后来看没有特别成熟的，都是一些Demo级别的，生态不是很好，开发起来可能比这个还要吃力些。所以，在刷了一个礼拜的题之后重拾信心来修改主题。以下是第二次的改造流程：

1. 从theme的__layout.swig开始，修改我需要的UI元素
2. 从theme的index.swig开始，删除不需要的模块，同时修改首屏的UI展示效果
3. 从theme的post.swig开始，修改博客能容的展示方式
4. 删除多余的样式表，DOM结构等
5. 完成

有了第一次失败的前车之鉴，这次开发算是顺利了很多，开始开发前在source下定义一个自定义custome目录，将开发的css／js／fonts／images统一放进去，然后在config.yml中定义自定义目录，在模板中就可以通过如下方式进行引用了
```html
<link href="{{ url_for(theme.custome) }}/css/my-theme.css?v={{ theme.version }}" rel="stylesheet" type="text/css" />
```
模板修改部分，主要修改了首页的post render和single post
在layout的marco下新增一个post-card的渲染模板，然后替换到首页默认的渲染模版，对于single post直接在之前的基础上修改了markdown的渲染样式。同时增加了博客的封面和自定义摘要字段。都是比较简单的操作。

后续的开发基本上就是修改dom结构了。最后来对比一下改版前的主题样式：

改版前：
![ShowImage](/1.png)

改版后：
![ShowImage](/2.png)

后续如果有时间的话继续把这个theme净化一下，因为里面好多配置都是自己不需要的，但也看到开源的主题要满足各种不同的口味真的也是做足了功课。

对于博客系统来说有三个功能是比较高级的功能：搜索，推荐，和评论。
评论和搜索现在有三方的插件可以完成，搜索和推荐功能的话感觉通过本地的文章索引也可以完成，评论则是只能依赖三方来做了，因为文件存储无法时时存储用户数据，同样的，如果要添加点赞这种功能，也只能依赖三方平台了。


